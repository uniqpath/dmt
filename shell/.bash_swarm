#!/bin/bash

function bee_start {
  zeta_start swarm
}

function bee {
  local bee=''
  dmt_platform_bin_command bee

  if [ ! -f "$bee" ]; then

    printf "${MAGENT}bee client not found${NC}\n"
    return
  fi

  "$bee" "$@"
}

function swarm_upload_single_file() {
  local file="$1"

  if [ -f "$file" ]; then
    printf "Uploading ${YELLOW}$file${NC} to ${MAGENTA}Swarm${NC}\n"
    curl -F file=@"$file" http://localhost:8888/files
  else
    printf "⚠️  Error: file ${YELLOW}${file}${NC} ${RED}does not exist.${NC}\n"
  fi
}

function supload_mp4() {
  local file="$1"

  if [ -f "$file" ]; then
    printf "Uploading mp4 video ${YELLOW}$file${NC} to ${MAGENTA}Swarm${NC}\n"
    curl -H "Content-Type: video/mp4" --data-binary @"$file" http://localhost:8888/files
  else
    printf "⚠️  Error: file ${YELLOW}${file}${NC} ${RED}does not exist.${NC}\n"
  fi
}

function supload_mp3() {
  local file="$1"

  # upload all mp3 in directory
  if [ -z "$file" ]; then
    printf "${GRAY}Uploading all mp3 files in this directory${NC}\n"
    for mp3File in *.mp3; do
      supload_mp3 "$mp3File"
      echo
    done
    return
  fi

  if [ -f "$file" ]; then
    printf "Uploading mp3 audio ${YELLOW}$file${NC} to ${MAGENTA}Swarm${NC}\n"
    curl -H "Content-Type: audio/mpeg" --data-binary @"$file" http://localhost:8888/files
  else
    printf "⚠️  Error: file ${YELLOW}${file}${NC} ${RED}does not exist.${NC}\n"
  fi
}

function supload_flac() {
  local file="$1"

  if [ -f "$file" ]; then
    printf "Uploading flac audio ${YELLOW}$file${NC} to ${MAGENTA}Swarm${NC}\n"
    curl -H "Content-Type: audio/flac" --data-binary @"$file" http://localhost:8888/files
  else
    printf "⚠️  Error: file ${YELLOW}${file}${NC} ${RED}does not exist.${NC}\n"
  fi
}

# function swarm_upload_single_file() {
#   local file="$1"

#   if [ -f "$file" ]; then
#     printf "Uploading ${YELLOW}$file${NC} to ${MAGENTA}Swarm${NC}\n"
#     local result=$(swarm up "$file")
#     echo "$result"
#   else
#     printf "⚠️  Error: file ${YELLOW}${file}${NC} ${RED}does not exist.${NC}\n"
#   fi
# }

function swarm_upload {
  if [ -f "$1" ]; then
    swarm_upload_single_file "$1"
  else
    for mp3File in *.mp3; do
      swarm_upload_single_file "$mp3File"
    done
  fi
}

function supload {
  swarm_upload "$@"
}
